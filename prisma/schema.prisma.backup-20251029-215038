generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model actividades {
  id                        Int                         @id @default(autoincrement())
  nombre                    String
  tipo                      TipoActividad
  descripcion               String?
  precio                    Decimal                     @default(0) @db.Decimal(8, 2)
  duracion                  Int?
  capacidadMaxima           Int?
  activa                    Boolean                     @default(true)
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  horarios_actividades      horarios_actividades[]
  participacion_actividades participacion_actividades[]
  reserva_aulas             reserva_aulas[]
  secciones_actividades     secciones_actividades[]
  personas                  Persona[]                   @relation("DocenteActividad")
}

model tipos_actividades {
  id          Int      @id @default(autoincrement())
  codigo      String   @unique @db.VarChar(50)
  nombre      String   @db.VarChar(100)
  descripcion String?  @db.Text
  activo      Boolean  @default(true)
  orden       Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([codigo])
  @@index([activo])
  @@index([orden])
}

model categorias_actividades {
  id          Int      @id @default(autoincrement())
  codigo      String   @unique @db.VarChar(50)
  nombre      String   @db.VarChar(100)
  descripcion String?  @db.Text
  activo      Boolean  @default(true)
  orden       Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([codigo])
  @@index([activo])
  @@index([orden])
}

model estados_actividades {
  id          Int      @id @default(autoincrement())
  codigo      String   @unique @db.VarChar(50)
  nombre      String   @db.VarChar(100)
  descripcion String?  @db.Text
  activo      Boolean  @default(true)
  orden       Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([codigo])
  @@index([activo])
  @@index([orden])
}

model dias_semana {
  id        Int      @id @default(autoincrement())
  codigo    String   @unique @db.VarChar(50)
  nombre    String   @db.VarChar(100)
  orden     Int
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([codigo])
  @@index([orden])
}

model roles_docentes {
  id          Int      @id @default(autoincrement())
  codigo      String   @unique @db.VarChar(50)
  nombre      String   @db.VarChar(100)
  descripcion String?  @db.Text
  activo      Boolean  @default(true)
  orden       Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([codigo])
  @@index([activo])
  @@index([orden])
}

model tipos_persona {
  id                   Int      @id @default(autoincrement())
  codigo               String   @unique @db.VarChar(50)
  nombre               String   @db.VarChar(100)
  descripcion          String?  @db.Text
  activo               Boolean  @default(true)
  orden                Int      @default(0)
  requiresCategoria    Boolean  @default(false) @map("requires_categoria")
  requiresEspecialidad Boolean  @default(false) @map("requires_especialidad")
  requiresCuit         Boolean  @default(false) @map("requires_cuit")
  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @updatedAt @map("updated_at")

  @@index([codigo])
  @@index([activo])
  @@index([orden])
}

model Aula {
  id                       Int                        @id @default(autoincrement())
  nombre                   String                     @unique
  capacidad                Int
  ubicacion                String?
  equipamiento             String?
  activa                   Boolean                    @default(true)
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @updatedAt
  reserva_aulas            reserva_aulas[]
  reservas_aulas_secciones reservas_aulas_secciones[]

  @@map("aulas")
}

model CategoriaSocio {
  id          Int       @id @default(autoincrement())
  codigo      String    @unique
  nombre      String    @unique
  descripcion String?
  montoCuota  Decimal   @default(0) @db.Decimal(10, 2)
  descuento   Decimal   @default(0) @db.Decimal(5, 2)
  activa      Boolean   @default(true)
  orden       Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  cuotas      Cuota[]
  personas    Persona[]

  @@map("categorias_socios")
}

model ComisionDirectiva {
  id          Int       @id @default(autoincrement())
  socioId     Int       @unique
  cargo       String
  fechaInicio DateTime
  fechaFin    DateTime?
  activo      Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  personas    Persona   @relation(fields: [socioId], references: [id], onDelete: Cascade)

  @@map("comision_directiva")
}

model ConfiguracionSistema {
  id          Int      @id @default(autoincrement())
  clave       String   @unique
  valor       String
  descripcion String?
  tipo        String   @default("STRING")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("configuracion_sistema")
}

model Cuota {
  id               Int            @id @default(autoincrement())
  reciboId         Int            @unique
  mes              Int
  anio             Int
  montoBase        Decimal        @db.Decimal(8, 2)
  montoActividades Decimal        @default(0) @db.Decimal(8, 2)
  montoTotal       Decimal        @db.Decimal(8, 2)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  categoriaId      Int
  categoria        CategoriaSocio @relation(fields: [categoriaId], references: [id])
  recibo           Recibo         @relation(fields: [reciboId], references: [id], onDelete: Cascade)

  @@unique([categoriaId, mes, anio])
  @@index([categoriaId])
  @@map("cuotas")
}

model Familiar {
  id                           Int            @id @default(autoincrement())
  socioId                      Int
  familiarId                   Int
  parentesco                   TipoParentesco
  createdAt                    DateTime       @default(now())
  updatedAt                    DateTime       @updatedAt
  descripcion                  String?
  permisoResponsableFinanciero Boolean        @default(false)
  permisoContactoEmergencia    Boolean        @default(false)
  permisoAutorizadoRetiro      Boolean        @default(false)
  descuento                    Decimal        @default(0) @db.Decimal(5, 2)
  activo                       Boolean        @default(true)
  grupoFamiliarId              Int?
  familiar                     Persona        @relation("FamiliarParentesco", fields: [familiarId], references: [id], onDelete: Cascade)
  socio                        Persona        @relation("SocioFamiliar", fields: [socioId], references: [id], onDelete: Cascade)

  @@unique([socioId, familiarId])
  @@index([grupoFamiliarId])
  @@index([activo])
  @@map("familiares")
}

model horarios_actividades {
  id          Int         @id @default(autoincrement())
  actividadId Int
  diaSemana   DiaSemana
  horaInicio  String
  horaFin     String
  activo      Boolean     @default(true)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime
  actividades actividades @relation(fields: [actividadId], references: [id], onDelete: Cascade)

  @@unique([actividadId, diaSemana, horaInicio])
}

model MedioPago {
  id            Int           @id @default(autoincrement())
  reciboId      Int
  tipo          MedioPagoTipo
  importe       Decimal       @db.Decimal(10, 2)
  numero        String?
  fecha         DateTime      @default(now())
  banco         String?
  observaciones String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  recibo        Recibo        @relation(fields: [reciboId], references: [id], onDelete: Cascade)

  @@map("medios_pago")
}

model Persona {
  id                        Int                         @id @default(autoincrement())
  tipo                      TipoPersona
  nombre                    String
  apellido                  String
  dni                       String                      @unique
  email                     String?                     @unique
  telefono                  String?
  direccion                 String?
  fechaNacimiento           DateTime?
  numeroSocio               Int?                        @unique
  categoria                 CategoriaSocioLegacy?
  fechaIngreso              DateTime?
  fechaBaja                 DateTime?
  motivoBaja                String?
  especialidad              String?
  honorariosPorHora         Decimal?                    @db.Decimal(10, 2)
  cuit                      String?                     @unique
  razonSocial               String?
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime                    @updatedAt
  categoriaId               Int?
  comision_directiva        ComisionDirectiva?
  parentescos               Familiar[]                  @relation("FamiliarParentesco")
  socios                    Familiar[]                  @relation("SocioFamiliar")
  participacion_actividades participacion_actividades[]
  participaciones_secciones participaciones_secciones[]
  categorias_socios         CategoriaSocio?             @relation(fields: [categoriaId], references: [id])
  recibosEmitidos           Recibo[]                    @relation("ReciboEmisor")
  recibosRecibidos          Recibo[]                    @relation("ReciboReceptor")
  reserva_aulas             reserva_aulas[]
  actividades               actividades[]               @relation("DocenteActividad")
  secciones_actividades     secciones_actividades[]     @relation("DocenteSeccion")

  @@index([categoriaId])
  @@map("personas")
}

model Recibo {
  id               Int          @id @default(autoincrement())
  numero           String       @unique
  tipo             TipoRecibo
  importe          Decimal      @db.Decimal(10, 2)
  fecha            DateTime     @default(now())
  fechaVencimiento DateTime?
  estado           EstadoRecibo @default(PENDIENTE)
  concepto         String
  observaciones    String?
  emisorId         Int?
  receptorId       Int?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  cuota            Cuota?
  mediosPago       MedioPago[]
  emisor           Persona?     @relation("ReciboEmisor", fields: [emisorId], references: [id])
  receptor         Persona?     @relation("ReciboReceptor", fields: [receptorId], references: [id])

  @@map("recibos")
}

model horarios_secciones {
  id                    Int                   @id @default(autoincrement())
  seccionId             Int
  diaSemana             DiaSemana
  horaInicio            String
  horaFin               String
  activo                Boolean               @default(true)
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  secciones_actividades secciones_actividades @relation(fields: [seccionId], references: [id], onDelete: Cascade)

  @@index([activo])
  @@index([diaSemana])
  @@index([seccionId, diaSemana, horaInicio])
}

model participacion_actividades {
  id             Int         @id @default(autoincrement())
  personaId      Int
  actividadId    Int
  fechaInicio    DateTime
  fechaFin       DateTime?
  precioEspecial Decimal?    @db.Decimal(8, 2)
  activa         Boolean     @default(true)
  observaciones  String?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime
  actividades    actividades @relation(fields: [actividadId], references: [id], onDelete: Cascade)
  personas       Persona     @relation(fields: [personaId], references: [id], onDelete: Cascade)

  @@unique([personaId, actividadId])
}

model participaciones_secciones {
  id                    Int                   @id @default(autoincrement())
  personaId             Int
  seccionId             Int
  fechaInicio           DateTime
  fechaFin              DateTime?
  precioEspecial        Decimal?              @db.Decimal(8, 2)
  activa                Boolean               @default(true)
  observaciones         String?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  personas              Persona               @relation(fields: [personaId], references: [id], onDelete: Cascade)
  secciones_actividades secciones_actividades @relation(fields: [seccionId], references: [id], onDelete: Cascade)

  @@unique([personaId, seccionId])
  @@index([activa])
  @@index([personaId])
  @@index([seccionId])
}

model reserva_aulas {
  id            Int          @id @default(autoincrement())
  aulaId        Int
  actividadId   Int?
  docenteId     Int
  fechaInicio   DateTime
  fechaFin      DateTime
  observaciones String?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime
  actividades   actividades? @relation(fields: [actividadId], references: [id])
  aulas         Aula         @relation(fields: [aulaId], references: [id], onDelete: Cascade)
  personas      Persona      @relation(fields: [docenteId], references: [id], onDelete: Cascade)
}

model reservas_aulas_secciones {
  id                    Int                   @id @default(autoincrement())
  seccionId             Int
  aulaId                Int
  diaSemana             DiaSemana
  horaInicio            String
  horaFin               String
  fechaVigencia         DateTime
  fechaFin              DateTime?
  observaciones         String?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  aulas                 Aula                  @relation(fields: [aulaId], references: [id], onDelete: Cascade)
  secciones_actividades secciones_actividades @relation(fields: [seccionId], references: [id], onDelete: Cascade)

  @@unique([seccionId, aulaId, diaSemana, horaInicio])
  @@index([aulaId, diaSemana, horaInicio])
  @@index([seccionId])
}

model secciones_actividades {
  id                        Int                         @id @default(autoincrement())
  actividadId               Int
  nombre                    String
  codigo                    String?
  capacidadMaxima           Int?
  activa                    Boolean                     @default(true)
  observaciones             String?
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  horarios_secciones        horarios_secciones[]
  participaciones_secciones participaciones_secciones[]
  reservas_aulas_secciones  reservas_aulas_secciones[]
  actividades               actividades                 @relation(fields: [actividadId], references: [id], onDelete: Cascade)
  personas                  Persona[]                   @relation("DocenteSeccion")

  @@unique([actividadId, nombre])
  @@index([activa])
  @@index([actividadId])
}

enum EstadoRecibo {
  PENDIENTE
  PAGADO
  VENCIDO
  CANCELADO
}

enum MedioPagoTipo {
  EFECTIVO
  TRANSFERENCIA
  TARJETA_DEBITO
  TARJETA_CREDITO
  CHEQUE
}

enum TipoParentesco {
  HIJO
  HIJA
  CONYUGE
  PADRE
  MADRE
  HERMANO
  HERMANA
  OTRO
  ABUELO
  ABUELA
  NIETO
  NIETA
  TIO
  TIA
  SOBRINO
  SOBRINA
  PRIMO
  PRIMA
}

enum TipoRecibo {
  CUOTA
  SUELDO
  DEUDA
  PAGO_ACTIVIDAD
}

enum CategoriaSocioLegacy {
  ACTIVO
  ESTUDIANTE
  FAMILIAR
  JUBILADO
}

enum DiaSemana {
  LUNES
  MARTES
  MIERCOLES
  JUEVES
  VIERNES
  SABADO
  DOMINGO
}

enum TipoActividad {
  CORO
  CLASE_CANTO
  CLASE_INSTRUMENTO
}

enum TipoPersona {
  SOCIO
  NO_SOCIO
  DOCENTE
  PROVEEDOR
}

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model actividades {
  id                          Int                           @id @default(autoincrement())
  codigo_actividad            String                        @unique @db.VarChar(50)
  nombre                      String                        @db.VarChar(200)
  tipo_actividad_id           Int
  categoria_id                Int
  estado_id                   Int                           @default(1)
  descripcion                 String?
  fecha_desde                 DateTime                      @db.Timestamp(6)
  fecha_hasta                 DateTime?                     @db.Timestamp(6)
  cupo_maximo                 Int?
  costo                       Decimal                       @default(0) @db.Decimal(10, 2)
  observaciones               String?
  created_at                  DateTime                      @default(now()) @db.Timestamp(6)
  updated_at                  DateTime                      @default(now()) @db.Timestamp(6)
  categorias_actividades      categorias_actividades        @relation(fields: [categoria_id], references: [id], onUpdate: NoAction, map: "fk_actividad_categoria")
  estados_actividades         estados_actividades           @relation(fields: [estado_id], references: [id], onUpdate: NoAction, map: "fk_actividad_estado")
  tipos_actividades           tipos_actividades             @relation(fields: [tipo_actividad_id], references: [id], onUpdate: NoAction, map: "fk_actividad_tipo")
  docentes_actividades        docentes_actividades[]
  horarios_actividades        horarios_actividades[]
  participaciones_actividades participaciones_actividades[]

  @@index([categoria_id], map: "idx_actividades_categoria")
  @@index([codigo_actividad], map: "idx_actividades_codigo")
  @@index([estado_id], map: "idx_actividades_estado")
  @@index([tipo_actividad_id], map: "idx_actividades_tipo")
  @@index([fecha_desde, fecha_hasta], map: "idx_actividades_vigencia")
}

model asistencias {
  id                          Int                         @id @default(autoincrement())
  participacion_id            Int
  fecha_sesion                DateTime                    @db.Timestamp(6)
  asistio                     Boolean                     @default(false)
  justificada                 Boolean                     @default(false)
  observaciones               String?
  created_at                  DateTime                    @default(now()) @db.Timestamp(6)
  updated_at                  DateTime                    @db.Timestamp(6)
  participaciones_actividades participaciones_actividades @relation(fields: [participacion_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_asistencia_participacion")

  @@unique([participacion_id, fecha_sesion], map: "uk_participacion_fecha")
  @@index([asistio], map: "idx_asistencias_asistio")
  @@index([fecha_sesion], map: "idx_asistencias_fecha")
  @@index([fecha_sesion, asistio], map: "idx_asistencias_fecha_asistio")
  @@index([participacion_id], map: "idx_asistencias_participacion")
}

model Aula {
  id                         Int                          @id @default(autoincrement())
  nombre                     String                       @unique
  capacidad                  Int
  ubicacion                  String?
  equipamiento               String?
  activa                     Boolean                      @default(true)
  tipo                       String?
  estado                     String?                      @default("disponible")
  observaciones              String?
  descripcion                String?
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime                     @updatedAt
  reservas_aulas_actividades reservas_aulas_actividades[]

  @@map("aulas")
}

model categorias_actividades {
  id          Int           @id @default(autoincrement())
  codigo      String        @unique @db.VarChar(50)
  nombre      String        @db.VarChar(100)
  descripcion String?
  activo      Boolean       @default(true)
  orden       Int           @default(0)
  created_at  DateTime      @default(now()) @db.Timestamp(6)
  updated_at  DateTime      @default(now()) @db.Timestamp(6)
  actividades actividades[]
}

model CategoriaSocio {
  id          Int       @id @default(autoincrement())
  codigo      String    @unique
  nombre      String    @unique
  descripcion String?
  montoCuota  Decimal   @default(0) @db.Decimal(10, 2)
  descuento   Decimal   @default(0) @db.Decimal(5, 2)
  activa      Boolean   @default(true)
  orden       Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  cuotas      Cuota[]
  personas    Persona[]

  @@map("categorias_socios")
}

model ComisionDirectiva {
  id          Int       @id @default(autoincrement())
  socioId     Int       @unique
  cargo       String
  fechaInicio DateTime
  fechaFin    DateTime?
  activo      Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  socio       Persona   @relation(fields: [socioId], references: [id], onDelete: Cascade)

  @@map("comision_directiva")
}

model ConfiguracionSistema {
  id          Int      @id @default(autoincrement())
  clave       String   @unique
  valor       String
  descripcion String?
  tipo        String   @default("STRING")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("configuracion_sistema")
}

model Cuota {
  id               Int            @id @default(autoincrement())
  reciboId         Int            @unique
  mes              Int
  anio             Int
  montoBase        Decimal        @db.Decimal(8, 2)
  montoActividades Decimal        @default(0) @db.Decimal(8, 2)
  montoTotal       Decimal        @db.Decimal(8, 2)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  categoriaId      Int
  categoria        CategoriaSocio @relation(fields: [categoriaId], references: [id])
  recibo           Recibo         @relation(fields: [reciboId], references: [id], onDelete: Cascade)

  @@unique([categoriaId, mes, anio])
  @@index([categoriaId])
  @@map("cuotas")
}

model dias_semana {
  id                   Int                    @id @default(autoincrement())
  codigo               String                 @unique @db.VarChar(20)
  nombre               String                 @db.VarChar(50)
  orden                Int
  horarios_actividades horarios_actividades[]
}

model docentes_actividades {
  id                  Int            @id @default(autoincrement())
  actividad_id        Int
  docente_id          Int
  rol_docente_id      Int
  fecha_asignacion    DateTime       @default(now()) @db.Timestamp(6)
  fecha_desasignacion DateTime?      @db.Timestamp(6)
  activo              Boolean        @default(true)
  observaciones       String?
  created_at          DateTime       @default(now()) @db.Timestamp(6)
  updated_at          DateTime       @default(now()) @db.Timestamp(6)
  actividades         actividades    @relation(fields: [actividad_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_docente_actividad")
  personas            Persona        @relation(fields: [docente_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_docente_persona")
  roles_docentes      roles_docentes @relation(fields: [rol_docente_id], references: [id], onUpdate: NoAction, map: "fk_docente_rol")

  @@unique([actividad_id, docente_id, rol_docente_id], map: "uk_actividad_docente_rol")
  @@index([actividad_id], map: "idx_docentes_actividades_actividad")
  @@index([activo], map: "idx_docentes_actividades_activo")
  @@index([docente_id], map: "idx_docentes_actividades_docente")
  @@index([rol_docente_id], map: "idx_docentes_actividades_rol")
}

model estados_actividades {
  id          Int           @id @default(autoincrement())
  codigo      String        @unique @db.VarChar(50)
  nombre      String        @db.VarChar(100)
  descripcion String?
  activo      Boolean       @default(true)
  orden       Int           @default(0)
  created_at  DateTime      @default(now()) @db.Timestamp(6)
  updated_at  DateTime      @default(now()) @db.Timestamp(6)
  actividades actividades[]
}

model Familiar {
  id         Int            @id @default(autoincrement())
  socioId    Int
  familiarId Int
  parentesco TipoParentesco
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
  familiar   Persona        @relation("FamiliarParentesco", fields: [familiarId], references: [id], onDelete: Cascade)
  socio      Persona        @relation("SocioFamiliar", fields: [socioId], references: [id], onDelete: Cascade)

  @@unique([socioId, familiarId])
  @@map("familiares")
}

model horarios_actividades {
  id                         Int                          @id @default(autoincrement())
  actividad_id               Int
  dia_semana_id              Int
  hora_inicio                DateTime                     @db.Time(6)
  hora_fin                   DateTime                     @db.Time(6)
  activo                     Boolean                      @default(true)
  created_at                 DateTime                     @default(now()) @db.Timestamp(6)
  updated_at                 DateTime                     @default(now()) @db.Timestamp(6)
  actividades                actividades                  @relation(fields: [actividad_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_horario_actividad")
  dias_semana                dias_semana                  @relation(fields: [dia_semana_id], references: [id], onUpdate: NoAction, map: "fk_horario_dia_semana")
  reservas_aulas_actividades reservas_aulas_actividades[]

  @@index([actividad_id], map: "idx_horarios_actividad")
  @@index([activo], map: "idx_horarios_activo")
  @@index([actividad_id, dia_semana_id, hora_inicio], map: "idx_horarios_composite")
  @@index([dia_semana_id], map: "idx_horarios_dia_semana")
}

model MedioPago {
  id            Int           @id @default(autoincrement())
  reciboId      Int
  tipo          MedioPagoTipo
  importe       Decimal       @db.Decimal(10, 2)
  numero        String?
  fecha         DateTime      @default(now())
  banco         String?
  observaciones String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  recibo        Recibo        @relation(fields: [reciboId], references: [id], onDelete: Cascade)

  @@map("medios_pago")
}

model participaciones_actividades {
  id              Int           @id @default(autoincrement())
  persona_id      Int
  actividad_id    Int
  fecha_inicio    DateTime      @db.Timestamp(6)
  fecha_fin       DateTime?     @db.Timestamp(6)
  precio_especial Decimal?      @db.Decimal(10, 2)
  activo          Boolean       @default(true)
  observaciones   String?
  created_at      DateTime      @default(now()) @db.Timestamp(6)
  updated_at      DateTime      @default(now()) @db.Timestamp(6)
  asistencias     asistencias[]
  actividades     actividades   @relation(fields: [actividad_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_participacion_actividad")
  personas        Persona       @relation(fields: [persona_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_participacion_persona")

  @@unique([persona_id, actividad_id], map: "uk_persona_actividad")
  @@index([actividad_id], map: "idx_participaciones_actividad")
  @@index([activo], map: "idx_participaciones_activo")
  @@index([fecha_inicio, fecha_fin], map: "idx_participaciones_fechas")
  @@index([persona_id], map: "idx_participaciones_persona")
}

model Persona {
  id                          Int                           @id @default(autoincrement())
  tipo                        TipoPersona
  nombre                      String
  apellido                    String
  dni                         String                        @unique
  email                       String?                       @unique
  telefono                    String?
  direccion                   String?
  fechaNacimiento             DateTime?
  numeroSocio                 Int?                          @unique
  fechaIngreso                DateTime?
  fechaBaja                   DateTime?
  motivoBaja                  String?
  especialidad                String?
  honorariosPorHora           Decimal?                      @db.Decimal(10, 2)
  cuit                        String?                       @unique
  razonSocial                 String?
  observaciones               String?
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime                      @updatedAt
  categoriaId                 Int?
  comisionDirectiva           ComisionDirectiva?
  docentes_actividades        docentes_actividades[]
  parentescos                 Familiar[]                    @relation("FamiliarParentesco")
  familiares                  Familiar[]                    @relation("SocioFamiliar")
  participaciones_actividades participaciones_actividades[]
  categoria                   CategoriaSocio?               @relation(fields: [categoriaId], references: [id])
  recibosEmitidos             Recibo[]                      @relation("ReciboEmisor")
  recibosRecibidos            Recibo[]                      @relation("ReciboReceptor")

  @@index([categoriaId])
  @@map("personas")
}

model Recibo {
  id               Int          @id @default(autoincrement())
  numero           String       @unique
  tipo             TipoRecibo
  importe          Decimal      @db.Decimal(10, 2)
  fecha            DateTime     @default(now())
  fechaVencimiento DateTime?
  estado           EstadoRecibo @default(PENDIENTE)
  concepto         String
  observaciones    String?
  emisorId         Int?
  receptorId       Int?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  cuota            Cuota?
  mediosPago       MedioPago[]
  emisor           Persona?     @relation("ReciboEmisor", fields: [emisorId], references: [id])
  receptor         Persona?     @relation("ReciboReceptor", fields: [receptorId], references: [id])

  @@map("recibos")
}

model reservas_aulas_actividades {
  id                   Int                  @id @default(autoincrement())
  horario_id           Int
  aula_id              Int
  fecha_vigencia_desde DateTime             @db.Timestamp(6)
  fecha_vigencia_hasta DateTime?            @db.Timestamp(6)
  observaciones        String?
  created_at           DateTime             @default(now()) @db.Timestamp(6)
  updated_at           DateTime             @default(now()) @db.Timestamp(6)
  aulas                Aula                 @relation(fields: [aula_id], references: [id], onUpdate: NoAction, map: "fk_reserva_aula")
  horarios_actividades horarios_actividades @relation(fields: [horario_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_reserva_horario")

  @@unique([horario_id, aula_id], map: "uk_horario_aula")
  @@index([aula_id], map: "idx_reservas_aula")
  @@index([horario_id], map: "idx_reservas_horario")
  @@index([fecha_vigencia_desde, fecha_vigencia_hasta], map: "idx_reservas_vigencia")
}

model roles_docentes {
  id                   Int                    @id @default(autoincrement())
  codigo               String                 @unique @db.VarChar(50)
  nombre               String                 @db.VarChar(100)
  descripcion          String?
  activo               Boolean                @default(true)
  orden                Int                    @default(0)
  created_at           DateTime               @default(now()) @db.Timestamp(6)
  updated_at           DateTime               @default(now()) @db.Timestamp(6)
  docentes_actividades docentes_actividades[]
}

model tipos_actividades {
  id          Int           @id @default(autoincrement())
  codigo      String        @unique @db.VarChar(50)
  nombre      String        @db.VarChar(100)
  descripcion String?
  activo      Boolean       @default(true)
  orden       Int           @default(0)
  created_at  DateTime      @default(now()) @db.Timestamp(6)
  updated_at  DateTime      @default(now()) @db.Timestamp(6)
  actividades actividades[]
}

enum EstadoRecibo {
  PENDIENTE
  PAGADO
  VENCIDO
  CANCELADO
}

enum MedioPagoTipo {
  EFECTIVO
  TRANSFERENCIA
  TARJETA_DEBITO
  TARJETA_CREDITO
  CHEQUE
}

enum TipoParentesco {
  HIJO
  HIJA
  CONYUGE
  PADRE
  MADRE
  HERMANO
  HERMANA
  OTRO
}

enum TipoPersona {
  SOCIO
  NO_SOCIO
  DOCENTE
  PROVEEDOR
}

enum TipoRecibo {
  CUOTA
  SUELDO
  DEUDA
  PAGO_ACTIVIDAD
}

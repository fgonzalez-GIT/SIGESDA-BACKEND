generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model actividades {
  id                        Int                         @id @default(autoincrement())
  codigoActividad           String                      @unique @map("codigo_actividad") @db.VarChar(50)
  nombre                    String
  tipoActividadId           Int                         @map("tipo_actividad_id")
  categoriaId               Int                         @map("categoria_id")
  estadoId                  Int                         @default(2) @map("estado_id")
  descripcion               String?
  capacidadMaxima           Int?                        @map("capacidad_maxima")
  fechaDesde                DateTime                    @map("fecha_desde")
  fechaHasta                DateTime?                   @map("fecha_hasta")
  costo                     Decimal                     @default(0) @db.Decimal(8, 2)
  observaciones             String?
  activa                    Boolean                     @default(true)
  createdAt                 DateTime                    @default(now()) @map("created_at")
  updatedAt                 DateTime                    @updatedAt @map("updated_at")
  tipoActividad             tipos_actividades           @relation(fields: [tipoActividadId], references: [id], onDelete: Restrict)
  categoria                 categorias_actividades      @relation(fields: [categoriaId], references: [id], onDelete: Restrict)
  estado                    estados_actividades         @relation(fields: [estadoId], references: [id], onDelete: Restrict)
  docentes_actividades      docentes_actividades[]
  horarios_actividades      horarios_actividades[]
  participacion_actividades participacion_actividades[]
  reserva_aulas             reserva_aulas[]
  secciones_actividades     secciones_actividades[]
  actividades_aulas         actividades_aulas[]

  @@index([activa])
  @@index([tipoActividadId])
  @@index([categoriaId])
  @@index([estadoId])
  @@index([codigoActividad])
  @@index([fechaDesde])
}

model tipos_actividades {
  id          Int           @id @default(autoincrement())
  codigo      String        @unique @db.VarChar(50)
  nombre      String        @db.VarChar(100)
  descripcion String?
  activo      Boolean       @default(true)
  orden       Int           @default(0)
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  actividades actividades[]

  @@index([codigo])
  @@index([activo])
  @@index([orden])
}

model categorias_actividades {
  id          Int           @id @default(autoincrement())
  codigo      String        @unique @db.VarChar(50)
  nombre      String        @db.VarChar(100)
  descripcion String?
  activo      Boolean       @default(true)
  orden       Int           @default(0)
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  actividades actividades[]

  @@index([codigo])
  @@index([activo])
  @@index([orden])
}

model estados_actividades {
  id          Int           @id @default(autoincrement())
  codigo      String        @unique @db.VarChar(50)
  nombre      String        @db.VarChar(100)
  descripcion String?
  activo      Boolean       @default(true)
  orden       Int           @default(0)
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  actividades actividades[]

  @@index([codigo])
  @@index([activo])
  @@index([orden])
}

model dias_semana {
  id                        Int                          @id @default(autoincrement())
  codigo                    String                       @unique @db.VarChar(50)
  nombre                    String                       @db.VarChar(100)
  orden                     Int
  createdAt                 DateTime                     @default(now()) @map("created_at")
  updatedAt                 DateTime                     @updatedAt @map("updated_at")
  horarios_actividades      horarios_actividades[]
  horarios_secciones        horarios_secciones[]         @relation("horarios_secciones_diasemana")
  reservas_aulas_secciones  reservas_aulas_secciones[]   @relation("reservas_aulas_secciones_diasemana")

  @@index([codigo])
  @@index([orden])
}

model roles_docentes {
  id                   Int                    @id @default(autoincrement())
  codigo               String                 @unique @db.VarChar(50)
  nombre               String                 @db.VarChar(100)
  descripcion          String?
  activo               Boolean                @default(true)
  orden                Int                    @default(0)
  createdAt            DateTime               @default(now()) @map("created_at")
  updatedAt            DateTime               @updatedAt @map("updated_at")
  docentes_actividades docentes_actividades[]

  @@index([codigo])
  @@index([activo])
  @@index([orden])
}

model tipos_persona {
  id                   Int      @id @default(autoincrement())
  codigo               String   @unique @db.VarChar(50)
  nombre               String   @db.VarChar(100)
  descripcion          String?
  activo               Boolean  @default(true)
  orden                Int      @default(0)
  requiresCategoria    Boolean  @default(false) @map("requires_categoria")
  requiresEspecialidad Boolean  @default(false) @map("requires_especialidad")
  requiresCuit         Boolean  @default(false) @map("requires_cuit")
  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @updatedAt @map("updated_at")

  @@index([codigo])
  @@index([activo])
  @@index([orden])
}

model Aula {
  id                       Int                        @id @default(autoincrement())
  nombre                   String                     @unique
  capacidad                Int
  ubicacion                String?
  activa                   Boolean                    @default(true)
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @updatedAt
  tipoAulaId               Int?                       @map("tipo_aula_id")
  estadoAulaId             Int?                       @map("estado_aula_id")
  descripcion              String?
  observaciones            String?
  estadoAula               EstadoAula?                @relation(fields: [estadoAulaId], references: [id])
  tipoAula                 TipoAula?                  @relation(fields: [tipoAulaId], references: [id])
  aulas_equipamientos      AulaEquipamiento[]
  reserva_aulas            reserva_aulas[]
  reservas_aulas_secciones reservas_aulas_secciones[]
  actividades_aulas        actividades_aulas[]

  @@index([tipoAulaId])
  @@index([estadoAulaId])
  @@index([activa])
  @@map("aulas")
}

model TipoAula {
  id          Int      @id @default(autoincrement())
  codigo      String   @unique @db.VarChar(50)
  nombre      String   @db.VarChar(100)
  descripcion String?
  activo      Boolean  @default(true)
  orden       Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  aulas       Aula[]

  @@index([codigo])
  @@index([activo])
  @@index([orden])
  @@map("tipos_aulas")
}

model EstadoAula {
  id          Int      @id @default(autoincrement())
  codigo      String   @unique @db.VarChar(50)
  nombre      String   @db.VarChar(100)
  descripcion String?
  activo      Boolean  @default(true)
  orden       Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  aulas       Aula[]

  @@index([codigo])
  @@index([activo])
  @@index([orden])
  @@map("estados_aulas")
}

model CategoriaEquipamiento {
  id            Int             @id @default(autoincrement())
  codigo        String          @unique @db.VarChar(50)
  nombre        String          @db.VarChar(100)
  descripcion   String?
  activo        Boolean         @default(true)
  orden         Int             @default(0)
  createdAt     DateTime        @default(now()) @map("created_at")
  updatedAt     DateTime        @updatedAt @map("updated_at")
  equipamientos Equipamiento[]

  @@index([codigo])
  @@index([activo])
  @@index([orden])
  @@map("categorias_equipamiento")
}

model EstadoEquipamiento {
  id            Int             @id @default(autoincrement())
  codigo        String          @unique @db.VarChar(50)
  nombre        String          @db.VarChar(100)
  descripcion   String?
  activo        Boolean         @default(true)
  orden         Int             @default(0)
  createdAt     DateTime        @default(now()) @map("created_at")
  updatedAt     DateTime        @updatedAt @map("updated_at")
  equipamientos Equipamiento[]

  @@index([codigo])
  @@index([activo])
  @@index([orden])
  @@map("estados_equipamiento")
}

model Equipamiento {
  id                      Int                      @id @default(autoincrement())
  codigo                  String                   @unique @db.VarChar(50)
  nombre                  String                   @unique @db.VarChar(200)
  categoriaEquipamientoId Int                      @map("categoria_equipamiento_id")
  estadoEquipamientoId    Int?                     @map("estado_equipamiento_id")
  cantidad                Int                      @default(1)
  descripcion             String?
  observaciones           String?
  activo                  Boolean                  @default(true)
  createdAt               DateTime                 @default(now()) @map("created_at")
  updatedAt               DateTime                 @updatedAt @map("updated_at")
  categoriaEquipamiento   CategoriaEquipamiento    @relation(fields: [categoriaEquipamientoId], references: [id], onDelete: Restrict)
  estadoEquipamiento      EstadoEquipamiento?      @relation(fields: [estadoEquipamientoId], references: [id], onDelete: Restrict)
  aulas_equipamientos     AulaEquipamiento[]

  @@index([codigo])
  @@index([categoriaEquipamientoId])
  @@index([estadoEquipamientoId])
  @@index([activo])
  @@map("equipamientos")
}

model AulaEquipamiento {
  id             Int          @id @default(autoincrement())
  aulaId         Int          @map("aula_id")
  equipamientoId Int          @map("equipamiento_id")
  cantidad       Int          @default(1)
  observaciones  String?
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")
  aula           Aula         @relation(fields: [aulaId], references: [id], onDelete: Cascade)
  equipamiento   Equipamiento @relation(fields: [equipamientoId], references: [id])

  @@unique([aulaId, equipamientoId])
  @@index([aulaId])
  @@index([equipamientoId])
  @@map("aulas_equipamientos")
}

model actividades_aulas {
  id                 Int         @id @default(autoincrement())
  actividadId        Int         @map("actividad_id")
  aulaId             Int         @map("aula_id")
  fechaAsignacion    DateTime    @default(now()) @map("fecha_asignacion")
  fechaDesasignacion DateTime?   @map("fecha_desasignacion")
  activa             Boolean     @default(true)
  prioridad          Int?        @default(1)
  observaciones      String?     @db.Text
  createdAt          DateTime    @default(now()) @map("created_at")
  updatedAt          DateTime    @updatedAt @map("updated_at")
  actividades        actividades @relation(fields: [actividadId], references: [id], onDelete: Cascade)
  aulas              Aula        @relation(fields: [aulaId], references: [id], onDelete: Cascade)

  @@unique([actividadId, aulaId], name: "unique_actividad_aula")
  @@index([actividadId])
  @@index([aulaId])
  @@index([activa])
}

model CategoriaSocio {
  id           Int           @id @default(autoincrement())
  codigo       String        @unique
  nombre       String        @unique
  descripcion  String?
  montoCuota   Decimal       @default(0) @db.Decimal(10, 2)
  descuento    Decimal       @default(0) @db.Decimal(5, 2)
  activa       Boolean       @default(true)
  orden        Int           @default(0)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  cuotas       Cuota[]
  personaTipos PersonaTipo[]
  personas     Persona[]

  @@map("categorias_socios")
}

model ComisionDirectiva {
  id          Int       @id @default(autoincrement())
  socioId     Int       @unique
  cargo       String
  fechaInicio DateTime
  fechaFin    DateTime?
  activo      Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  personas    Persona   @relation(fields: [socioId], references: [id], onDelete: Cascade)

  @@map("comision_directiva")
}

model ConfiguracionSistema {
  id          Int      @id @default(autoincrement())
  clave       String   @unique
  valor       String
  descripcion String?
  tipo        String   @default("STRING")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("configuracion_sistema")
}

model Cuota {
  id                    Int                 @id @default(autoincrement())
  reciboId              Int                 @unique
  mes                   Int
  anio                  Int
  montoBase             Decimal?            @db.Decimal(8, 2)
  montoActividades      Decimal?            @default(0) @db.Decimal(8, 2)
  montoTotal            Decimal             @db.Decimal(8, 2)
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  categoriaId           Int
  categoria             CategoriaSocio      @relation(fields: [categoriaId], references: [id])
  recibo                Recibo                  @relation(fields: [reciboId], references: [id], onDelete: Cascade)
  items                 ItemCuota[]
  aplicacionesReglas    AplicacionRegla[]
  historial             HistorialAjusteCuota[]

  @@index([categoriaId])
  @@index([mes, anio])
  @@index([categoriaId, mes, anio])
  @@map("cuotas")
}

/// Catálogo de categorías de ítems (BASE, ACTIVIDAD, DESCUENTO, etc.) - Gestionable vía CRUD
model CategoriaItem {
  id          Int              @id @default(autoincrement())
  codigo      String           @unique @db.VarChar(50)
  nombre      String           @db.VarChar(100)
  descripcion String?
  icono       String?          @db.VarChar(10)
  color       String?          @db.VarChar(20)
  activo      Boolean          @default(true)
  orden       Int              @default(0)
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")
  tiposItems  TipoItemCuota[]

  @@index([codigo])
  @@index([activo])
  @@index([orden])
  @@map("categorias_items")
}

/// Catálogo de tipos de ítems configurables para cuotas
model TipoItemCuota {
  id              Int            @id @default(autoincrement())
  codigo          String         @unique @db.VarChar(100)
  nombre          String         @db.VarChar(200)
  descripcion     String?
  categoriaItemId Int            @map("categoria_item_id")
  esCalculado     Boolean        @default(true) @map("es_calculado")
  formula         Json?
  activo          Boolean        @default(true)
  orden           Int            @default(0)
  configurable    Boolean        @default(true)
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")
  categoriaItem   CategoriaItem  @relation(fields: [categoriaItemId], references: [id], onDelete: Restrict)
  itemsCuota      ItemCuota[]

  @@index([codigo])
  @@index([categoriaItemId])
  @@index([activo])
  @@index([orden])
  @@map("tipos_items_cuota")
}

/// Ítems individuales que componen una cuota (base, actividades, descuentos, etc.)
model ItemCuota {
  id                  Int                 @id @default(autoincrement())
  cuotaId             Int                 @map("cuota_id")
  tipoItemId          Int                 @map("tipo_item_id")
  concepto            String
  monto               Decimal             @db.Decimal(10, 2)
  cantidad            Decimal             @default(1) @db.Decimal(8, 2)
  porcentaje          Decimal?            @db.Decimal(5, 2)
  esAutomatico        Boolean             @default(true) @map("es_automatico")
  esEditable          Boolean             @default(false) @map("es_editable")
  observaciones       String?
  metadata            Json?
  createdAt           DateTime            @default(now()) @map("created_at")
  updatedAt           DateTime            @updatedAt @map("updated_at")
  cuota               Cuota               @relation(fields: [cuotaId], references: [id], onDelete: Cascade)
  tipoItem            TipoItemCuota       @relation(fields: [tipoItemId], references: [id], onDelete: Restrict)
  aplicacionesReglas  AplicacionRegla[]

  @@index([cuotaId])
  @@index([tipoItemId])
  @@index([cuotaId, tipoItemId])
  @@map("items_cuota")
}

model Familiar {
  id                           Int            @id @default(autoincrement())
  socioId                      Int
  familiarId                   Int
  parentesco                   TipoParentesco
  createdAt                    DateTime       @default(now())
  updatedAt                    DateTime       @updatedAt
  descripcion                  String?
  permisoResponsableFinanciero Boolean        @default(false)
  permisoContactoEmergencia    Boolean        @default(false)
  permisoAutorizadoRetiro      Boolean        @default(false)
  descuento                    Decimal        @default(0) @db.Decimal(5, 2)
  activo                       Boolean        @default(true)
  grupoFamiliarId              Int?
  familiar                     Persona        @relation("FamiliarParentesco", fields: [familiarId], references: [id], onDelete: Cascade)
  socio                        Persona        @relation("SocioFamiliar", fields: [socioId], references: [id], onDelete: Cascade)

  @@unique([socioId, familiarId])
  @@index([socioId, activo])
  @@index([familiarId, activo])
  @@index([grupoFamiliarId])
  @@index([activo])
  @@map("familiares")
}

model horarios_actividades {
  id          Int          @id @default(autoincrement())
  actividadId Int          @map("actividad_id")
  diaSemanaId Int          @map("dia_semana_id")
  horaInicio  DateTime     @map("hora_inicio") @db.Time
  horaFin     DateTime     @map("hora_fin") @db.Time
  activo      Boolean      @default(true)
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  actividades actividades  @relation(fields: [actividadId], references: [id], onDelete: Cascade)
  diaSemana   dias_semana  @relation(fields: [diaSemanaId], references: [id], onDelete: Restrict)

  @@unique([actividadId, diaSemanaId, horaInicio])
  @@index([actividadId])
  @@index([diaSemanaId])
}

model docentes_actividades {
  id                 Int            @id @default(autoincrement())
  actividadId        Int            @map("actividad_id")
  docenteId          Int            @map("docente_id")
  rolDocenteId       Int            @map("rol_docente_id")
  fechaAsignacion    DateTime       @default(now()) @map("fecha_asignacion")
  fechaDesasignacion DateTime?      @map("fecha_desasignacion")
  activo             Boolean        @default(true)
  observaciones      String?
  createdAt          DateTime       @default(now()) @map("created_at")
  updatedAt          DateTime       @updatedAt @map("updated_at")
  actividades        actividades    @relation(fields: [actividadId], references: [id], onDelete: Cascade)
  personas           Persona        @relation(fields: [docenteId], references: [id], onDelete: Cascade)
  rolesDocentes      roles_docentes @relation(fields: [rolDocenteId], references: [id])

  @@unique([actividadId, docenteId, rolDocenteId], name: "unique_docente_actividad_rol")
  @@index([actividadId])
  @@index([docenteId])
  @@index([rolDocenteId])
  @@index([activo])
}

model MedioPago {
  id            Int           @id @default(autoincrement())
  reciboId      Int
  tipo          MedioPagoTipo
  importe       Decimal       @db.Decimal(10, 2)
  numero        String?
  fecha         DateTime      @default(now())
  banco         String?
  observaciones String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  recibo        Recibo        @relation(fields: [reciboId], references: [id], onDelete: Cascade)

  @@map("medios_pago")
}

model Persona {
  id                        Int                         @id @default(autoincrement())
  nombre                    String
  apellido                  String
  dni                       String                      @unique
  email                     String?                     @unique
  telefono                  String?
  direccion                 String?
  fechaNacimiento           DateTime?
  numeroSocio               Int?                        @unique
  categoria                 CategoriaSocioLegacy?
  fechaIngreso              DateTime?
  fechaBaja                 DateTime?
  motivoBaja                String?
  especialidad              String?
  honorariosPorHora         Decimal?                    @db.Decimal(10, 2)
  cuit                      String?                     @unique
  razonSocial               String?
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime                    @updatedAt
  categoriaId               Int?
  activo                    Boolean                     @default(true)
  genero                    Genero?
  comision_directiva        ComisionDirectiva?
  contactos                 ContactoPersona[]
  docentes_actividades      docentes_actividades[]
  parentescos               Familiar[]                  @relation("FamiliarParentesco")
  socios                    Familiar[]                  @relation("SocioFamiliar")
  participacion_actividades participacion_actividades[]
  participaciones_secciones participaciones_secciones[]
  tipos                     PersonaTipo[]
  categorias_socios         CategoriaSocio?             @relation(fields: [categoriaId], references: [id])
  recibosEmitidos           Recibo[]                    @relation("ReciboEmisor")
  recibosRecibidos          Recibo[]                    @relation("ReciboReceptor")
  reservasAprobadas         reserva_aulas[]             @relation("ReservaAprobadaPor")
  reservasCanceladas        reserva_aulas[]             @relation("ReservaCanceladaPor")
  reserva_aulas             reserva_aulas[]             @relation("ReservaDocente")
  secciones_actividades     secciones_actividades[]     @relation("DocenteSeccion")
  ajustesCuota              AjusteCuotaSocio[]
  historialCuotas           HistorialAjusteCuota[]
  exencionesCuota           ExencionCuota[]

  @@index([categoriaId])
  @@index([activo])
  @@index([genero])
  @@map("personas")
}

model Recibo {
  id               Int          @id @default(autoincrement())
  numero           String       @unique @default(dbgenerated("next_recibo_numero()"))
  tipo             TipoRecibo
  importe          Decimal      @db.Decimal(10, 2)
  fecha            DateTime     @default(now())
  fechaVencimiento DateTime?
  estado           EstadoRecibo @default(PENDIENTE)
  concepto         String
  observaciones    String?
  emisorId         Int?
  receptorId       Int?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  cuota            Cuota?
  mediosPago       MedioPago[]
  emisor           Persona?     @relation("ReciboEmisor", fields: [emisorId], references: [id])
  receptor         Persona?     @relation("ReciboReceptor", fields: [receptorId], references: [id])

  @@index([receptorId])
  @@index([emisorId])
  @@index([estado])
  @@index([fecha])
  @@index([fechaVencimiento])
  @@index([estado, fechaVencimiento])
  @@map("recibos")
}

model horarios_secciones {
  id                    Int                   @id @default(autoincrement())
  seccionId             Int                   @map("seccion_id")
  diaSemanaId           Int                   @map("dia_semana_id")
  horaInicio            String                @map("hora_inicio")
  horaFin               String                @map("hora_fin")
  activo                Boolean               @default(true)
  createdAt             DateTime              @default(now()) @map("created_at")
  updatedAt             DateTime              @updatedAt @map("updated_at")
  secciones_actividades secciones_actividades @relation(fields: [seccionId], references: [id], onDelete: Cascade)
  diaSemana             dias_semana           @relation("horarios_secciones_diasemana", fields: [diaSemanaId], references: [id], onDelete: Restrict)

  @@index([activo])
  @@index([diaSemanaId])
  @@index([seccionId, diaSemanaId, horaInicio])
}

model participacion_actividades {
  id             Int         @id @default(autoincrement())
  personaId      Int
  actividadId    Int
  fechaInicio    DateTime
  fechaFin       DateTime?
  precioEspecial Decimal?    @db.Decimal(8, 2)
  activa         Boolean     @default(true)
  observaciones  String?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  actividades    actividades @relation(fields: [actividadId], references: [id], onDelete: Cascade)
  personas       Persona     @relation(fields: [personaId], references: [id], onDelete: Cascade)

  @@unique([personaId, actividadId])
  @@index([personaId, activa])
  @@index([actividadId, activa])
  @@index([personaId, fechaInicio, fechaFin])
}

model participaciones_secciones {
  id                    Int                   @id @default(autoincrement())
  personaId             Int
  seccionId             Int
  fechaInicio           DateTime
  fechaFin              DateTime?
  precioEspecial        Decimal?              @db.Decimal(8, 2)
  activa                Boolean               @default(true)
  observaciones         String?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  personas              Persona               @relation(fields: [personaId], references: [id], onDelete: Cascade)
  secciones_actividades secciones_actividades @relation(fields: [seccionId], references: [id], onDelete: Cascade)

  @@unique([personaId, seccionId])
  @@index([activa])
  @@index([personaId])
  @@index([seccionId])
}

model EstadoReserva {
  id          Int             @id @default(autoincrement())
  codigo      String          @unique @db.VarChar(50)
  nombre      String          @db.VarChar(100)
  descripcion String?
  activo      Boolean         @default(true)
  orden       Int             @default(0)
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")
  reservas    reserva_aulas[]

  @@index([codigo])
  @@index([activo])
  @@index([orden])
  @@map("estados_reservas")
}

model reserva_aulas {
  id                Int            @id @default(autoincrement())
  aulaId            Int
  actividadId       Int?
  docenteId         Int
  fechaInicio       DateTime
  fechaFin          DateTime
  observaciones     String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  estadoReservaId   Int?           @map("estado_reserva_id")
  activa            Boolean        @default(true)
  motivoCancelacion String?        @map("motivo_cancelacion")
  canceladoPorId    Int?           @map("cancelado_por_id")
  aprobadoPorId     Int?           @map("aprobado_por_id")
  actividades       actividades?   @relation(fields: [actividadId], references: [id])
  aprobadoPor       Persona?       @relation("ReservaAprobadaPor", fields: [aprobadoPorId], references: [id])
  aulas             Aula           @relation(fields: [aulaId], references: [id], onDelete: Cascade)
  canceladoPor      Persona?       @relation("ReservaCanceladaPor", fields: [canceladoPorId], references: [id])
  personas          Persona        @relation("ReservaDocente", fields: [docenteId], references: [id], onDelete: Cascade)
  estadoReserva     EstadoReserva? @relation(fields: [estadoReservaId], references: [id])

  @@index([aulaId, fechaInicio, fechaFin])
  @@index([docenteId, fechaInicio])
  @@index([actividadId])
  @@index([estadoReservaId])
  @@index([fechaInicio, fechaFin])
  @@index([activa])
}

model reservas_aulas_secciones {
  id                    Int                   @id @default(autoincrement())
  seccionId             Int
  aulaId                Int
  diaSemanaId           Int
  horaInicio            String
  horaFin               String
  fechaVigencia         DateTime
  fechaFin              DateTime?
  observaciones         String?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  aulas                 Aula                  @relation(fields: [aulaId], references: [id], onDelete: Cascade)
  secciones_actividades secciones_actividades @relation(fields: [seccionId], references: [id], onDelete: Cascade)
  diaSemana             dias_semana           @relation("reservas_aulas_secciones_diasemana", fields: [diaSemanaId], references: [id], onDelete: Restrict)

  @@unique([seccionId, aulaId, diaSemanaId, horaInicio])
  @@index([aulaId, diaSemanaId, horaInicio])
  @@index([seccionId])
}

model secciones_actividades {
  id                        Int                         @id @default(autoincrement())
  actividadId               Int
  nombre                    String
  codigo                    String?
  capacidadMaxima           Int?
  activa                    Boolean                     @default(true)
  observaciones             String?
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  horarios_secciones        horarios_secciones[]
  participaciones_secciones participaciones_secciones[]
  reservas_aulas_secciones  reservas_aulas_secciones[]
  actividades               actividades                 @relation(fields: [actividadId], references: [id], onDelete: Cascade)
  personas                  Persona[]                   @relation("DocenteSeccion")

  @@unique([actividadId, nombre])
  @@index([activa])
  @@index([actividadId])
}

model TipoPersonaCatalogo {
  id                   Int           @id @default(autoincrement())
  codigo               String        @unique @db.VarChar(50)
  nombre               String        @db.VarChar(100)
  descripcion          String?
  activo               Boolean       @default(true)
  orden                Int           @default(0)
  requiresCategoria    Boolean       @default(false) @map("requires_categoria")
  requiresEspecialidad Boolean       @default(false) @map("requires_especialidad")
  requiresCuit         Boolean       @default(false) @map("requires_cuit")
  createdAt            DateTime      @default(now()) @map("created_at")
  updatedAt            DateTime      @updatedAt @map("updated_at")
  personaTipos         PersonaTipo[]

  @@index([codigo])
  @@index([activo])
  @@index([orden])
  @@map("tipo_persona_catalogo")
}

model EspecialidadDocente {
  id           Int           @id @default(autoincrement())
  codigo       String        @unique @db.VarChar(50)
  nombre       String        @db.VarChar(100)
  descripcion  String?
  activo       Boolean       @default(true)
  orden        Int           @default(0)
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  personaTipos PersonaTipo[]

  @@index([codigo])
  @@index([activo])
  @@map("especialidad_docente")
}

model RazonSocial {
  id           Int           @id @default(autoincrement())
  codigo       String        @unique @db.VarChar(50)
  nombre       String        @db.VarChar(200)
  descripcion  String?
  activo       Boolean       @default(true)
  orden        Int           @default(0)
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  personaTipos PersonaTipo[]

  @@index([codigo])
  @@index([activo])
  @@index([orden])
  @@map("razon_social_catalogo")
}

model PersonaTipo {
  id                 Int                  @id @default(autoincrement())
  personaId          Int                  @map("persona_id")
  tipoPersonaId      Int                  @map("tipo_persona_id")
  activo             Boolean              @default(true)
  fechaAsignacion    DateTime             @default(now()) @map("fecha_asignacion")
  fechaDesasignacion DateTime?            @map("fecha_desasignacion")
  categoriaId        Int?                 @map("categoria_id")
  numeroSocio        Int?                 @map("numero_socio")
  fechaIngreso       DateTime?            @map("fecha_ingreso")
  fechaBaja          DateTime?            @map("fecha_baja")
  motivoBaja         String?              @map("motivo_baja") @db.VarChar(200)
  especialidadId     Int?                 @map("especialidad_id")
  honorariosPorHora  Decimal?             @map("honorarios_por_hora") @db.Decimal(10, 2)
  cuit               String?              @db.VarChar(11)
  observaciones      String?
  createdAt          DateTime             @default(now()) @map("created_at")
  updatedAt          DateTime             @updatedAt @map("updated_at")
  razonSocialId      Int?                 @map("razon_social_id")
  categoria          CategoriaSocio?      @relation(fields: [categoriaId], references: [id])
  especialidad       EspecialidadDocente? @relation(fields: [especialidadId], references: [id])
  persona            Persona              @relation(fields: [personaId], references: [id], onDelete: Cascade)
  razonSocial        RazonSocial?         @relation(fields: [razonSocialId], references: [id])
  tipoPersona        TipoPersonaCatalogo  @relation(fields: [tipoPersonaId], references: [id])

  @@unique([personaId, tipoPersonaId])
  @@index([personaId])
  @@index([tipoPersonaId])
  @@index([activo])
  @@index([categoriaId])
  @@index([especialidadId])
  @@index([numeroSocio])
  @@map("persona_tipo")
}

model ContactoPersona {
  id              Int                  @id @default(autoincrement())
  personaId       Int                  @map("persona_id")
  tipoContactoId  Int                  @map("tipo_contacto_id")
  valor           String               @db.VarChar(200)
  principal       Boolean              @default(false)
  activo          Boolean              @default(true)
  observaciones   String?              @db.VarChar(500)
  createdAt       DateTime             @default(now()) @map("created_at")
  updatedAt       DateTime             @updatedAt @map("updated_at")
  persona         Persona              @relation(fields: [personaId], references: [id], onDelete: Cascade)
  tipoContacto    TipoContactoCatalogo @relation(fields: [tipoContactoId], references: [id], onDelete: Restrict)

  @@index([personaId])
  @@index([activo])
  @@index([principal])
  @@index([tipoContactoId])
  @@map("contacto_persona")
}

model TipoContactoCatalogo {
  id          Int               @id @default(autoincrement())
  codigo      String            @unique @db.VarChar(50)
  nombre      String            @db.VarChar(100)
  descripcion String?
  icono       String?           @db.VarChar(50)
  pattern     String?           @db.VarChar(500)
  activo      Boolean           @default(true)
  orden       Int               @default(0)
  createdAt   DateTime          @default(now()) @map("created_at")
  updatedAt   DateTime          @updatedAt @map("updated_at")
  contactos   ContactoPersona[]

  @@index([codigo])
  @@index([activo])
  @@index([orden])
  @@map("tipo_contacto_catalogo")
}

enum EstadoRecibo {
  PENDIENTE
  PAGADO
  VENCIDO
  CANCELADO
}

enum MedioPagoTipo {
  EFECTIVO
  TRANSFERENCIA
  TARJETA_DEBITO
  TARJETA_CREDITO
  CHEQUE
}

enum TipoParentesco {
  HIJO
  HIJA
  CONYUGE
  PADRE
  MADRE
  HERMANO
  HERMANA
  OTRO
  ABUELO
  ABUELA
  NIETO
  NIETA
  TIO
  TIA
  SOBRINO
  SOBRINA
  PRIMO
  PRIMA
  ESPOSA
  ESPOSO
}

enum TipoRecibo {
  CUOTA
  SUELDO
  DEUDA
  PAGO_ACTIVIDAD
}

enum CategoriaSocioLegacy {
  ACTIVO
  ESTUDIANTE
  FAMILIAR
  JUBILADO
}

enum TipoPersona {
  SOCIO
  NO_SOCIO
  DOCENTE
  PROVEEDOR
}

enum Genero {
  MASCULINO
  FEMENINO
  NO_BINARIO
  PREFIERO_NO_DECIR
}

// ══════════════════════════════════════════════════════════════════════
// FASE 3: Motor de Reglas de Descuentos
// ══════════════════════════════════════════════════════════════════════

enum ModoAplicacionDescuento {
  ACUMULATIVO
  EXCLUSIVO
  MAXIMO
  PERSONALIZADO
}

/// Reglas configurables de descuentos para cuotas
model ReglaDescuento {
  id                    Int                        @id @default(autoincrement())
  codigo                String                     @unique @db.VarChar(100)
  nombre                String                     @db.VarChar(200)
  descripcion           String?
  prioridad             Int                        @default(0)
  modoAplicacion        ModoAplicacionDescuento    @map("modo_aplicacion")
  maxDescuento          Decimal?                   @map("max_descuento") @db.Decimal(5, 2)
  condiciones           Json
  formula               Json
  activa                Boolean                    @default(true)
  aplicarABase          Boolean                    @default(true) @map("aplicar_a_base")
  aplicarAActividades   Boolean                    @default(true) @map("aplicar_a_actividades")
  createdAt             DateTime                   @default(now()) @map("created_at")
  updatedAt             DateTime                   @updatedAt @map("updated_at")
  aplicaciones          AplicacionRegla[]

  @@index([codigo])
  @@index([prioridad])
  @@index([activa])
  @@map("reglas_descuentos")
}

/// Configuración global del sistema de descuentos
model ConfiguracionDescuentos {
  id                            Int      @id @default(autoincrement())
  limiteDescuentoTotal          Decimal  @default(80.00) @map("limite_descuento_total") @db.Decimal(5, 2)
  aplicarDescuentosABase        Boolean  @default(true) @map("aplicar_descuentos_a_base")
  aplicarDescuentosAActividades Boolean  @default(true) @map("aplicar_descuentos_a_actividades")
  prioridadReglas               Json     @default("[]") @map("prioridad_reglas")
  activa                        Boolean  @default(true)
  createdAt                     DateTime @default(now()) @map("created_at")
  updatedAt                     DateTime @updatedAt @map("updated_at")

  @@map("configuracion_descuentos")
}

/// Log de auditoría de aplicaciones de reglas de descuento
model AplicacionRegla {
  id                 Int             @id @default(autoincrement())
  cuotaId            Int             @map("cuota_id")
  reglaId            Int             @map("regla_id")
  itemCuotaId        Int?            @map("item_cuota_id")
  porcentajeAplicado Decimal         @map("porcentaje_aplicado") @db.Decimal(5, 2)
  montoDescuento     Decimal         @map("monto_descuento") @db.Decimal(10, 2)
  metadata           Json?
  createdAt          DateTime        @default(now()) @map("created_at")
  cuota              Cuota           @relation(fields: [cuotaId], references: [id], onDelete: Cascade)
  regla              ReglaDescuento  @relation(fields: [reglaId], references: [id], onDelete: Restrict)
  itemCuota          ItemCuota?      @relation(fields: [itemCuotaId], references: [id], onDelete: SetNull)

  @@index([cuotaId])
  @@index([reglaId])
  @@index([itemCuotaId])
  @@map("aplicaciones_reglas")
}

// ══════════════════════════════════════════════════════════════════════
// FASE 4: Funcionalidades Pendientes - Ajustes Manuales
// ══════════════════════════════════════════════════════════════════════

enum TipoAjusteCuota {
  DESCUENTO_FIJO
  DESCUENTO_PORCENTAJE
  RECARGO_FIJO
  RECARGO_PORCENTAJE
  MONTO_FIJO_TOTAL
}

enum ScopeAjusteCuota {
  TODOS_ITEMS
  SOLO_BASE
  SOLO_ACTIVIDADES
  ITEMS_ESPECIFICOS
}

enum AccionHistorialCuota {
  CREAR_AJUSTE
  MODIFICAR_AJUSTE
  ELIMINAR_AJUSTE
  APLICAR_AJUSTE_MANUAL
  RECALCULAR_CUOTA
  REGENERAR_CUOTA
  CREAR_EXENCION
  MODIFICAR_EXENCION
  ELIMINAR_EXENCION
  APLICAR_EXENCION
}

/// Ajustes manuales configurables por socio para cuotas
/// Permite definir ajustes permanentes o temporales que se aplican automáticamente
model AjusteCuotaSocio {
  id              Int                     @id @default(autoincrement())
  personaId       Int                     @map("persona_id")
  tipoAjuste      TipoAjusteCuota        @map("tipo_ajuste")
  valor           Decimal                 @db.Decimal(10, 2)
  concepto        String                  @db.VarChar(200)
  fechaInicio     DateTime                @map("fecha_inicio")
  fechaFin        DateTime?               @map("fecha_fin")
  activo          Boolean                 @default(true)
  motivo          String?
  observaciones   String?
  aplicaA         ScopeAjusteCuota       @default(TODOS_ITEMS) @map("aplica_a")
  itemsAfectados  Json?                   @map("items_afectados")
  aprobadoPor     String?                 @map("aprobado_por") @db.VarChar(100)
  createdAt       DateTime                @default(now()) @map("created_at")
  updatedAt       DateTime                @updatedAt @map("updated_at")
  persona         Persona                 @relation(fields: [personaId], references: [id], onDelete: Cascade)
  historial       HistorialAjusteCuota[]

  @@index([personaId])
  @@index([activo])
  @@index([fechaInicio, fechaFin])
  @@index([personaId, activo, fechaInicio])
  @@map("ajustes_cuota_socio")
}

/// Historial completo de cambios y modificaciones en cuotas
/// Registro de auditoría para tracking de todas las operaciones
model HistorialAjusteCuota {
  id              Int                   @id @default(autoincrement())
  ajusteId        Int?                  @map("ajuste_id")
  cuotaId         Int?                  @map("cuota_id")
  exencionId      Int?                  @map("exencion_id")
  personaId       Int                   @map("persona_id")
  accion          AccionHistorialCuota
  datosPrevios    Json?                 @map("datos_previos")
  datosNuevos     Json                  @map("datos_nuevos")
  usuario         String?               @db.VarChar(100)
  motivoCambio    String?               @map("motivo_cambio")
  createdAt       DateTime              @default(now()) @map("created_at")
  ajuste          AjusteCuotaSocio?     @relation(fields: [ajusteId], references: [id], onDelete: Cascade)
  cuota           Cuota?                @relation(fields: [cuotaId], references: [id], onDelete: Cascade)
  exencion        ExencionCuota?        @relation(fields: [exencionId], references: [id], onDelete: Cascade)
  persona         Persona               @relation(fields: [personaId], references: [id], onDelete: Cascade)

  @@index([ajusteId])
  @@index([cuotaId])
  @@index([exencionId])
  @@index([personaId])
  @@index([accion])
  @@index([createdAt])
  @@map("historial_ajustes_cuota")
}

// ══════════════════════════════════════════════════════════════════════
// FASE 4: Task 4.2 - Exenciones Temporales
// ══════════════════════════════════════════════════════════════════════

enum TipoExencion {
  TOTAL
  PARCIAL
}

enum MotivoExencion {
  BECA
  SOCIO_FUNDADOR
  SOCIO_HONORARIO
  SITUACION_ECONOMICA
  SITUACION_SALUD
  INTERCAMBIO_SERVICIOS
  PROMOCION
  FAMILIAR_DOCENTE
  OTRO
}

enum EstadoExencion {
  PENDIENTE_APROBACION
  APROBADA
  RECHAZADA
  VIGENTE
  VENCIDA
  REVOCADA
}

/// Exenciones temporales de cuotas para socios
/// Permite eximir total o parcialmente del pago de cuotas por períodos específicos
model ExencionCuota {
  id                    Int                     @id @default(autoincrement())
  personaId             Int                     @map("persona_id")
  tipoExencion          TipoExencion           @map("tipo_exencion")
  motivoExencion        MotivoExencion         @map("motivo_exencion")
  estado                EstadoExencion         @default(PENDIENTE_APROBACION)
  porcentajeExencion    Decimal                @default(100) @map("porcentaje_exencion") @db.Decimal(5, 2)
  fechaInicio           DateTime               @map("fecha_inicio")
  fechaFin              DateTime?              @map("fecha_fin")
  descripcion           String                 @db.VarChar(500)
  justificacion         String?
  documentacionAdjunta  String?                @map("documentacion_adjunta") @db.VarChar(255)
  solicitadoPor         String?                @map("solicitado_por") @db.VarChar(100)
  fechaSolicitud        DateTime               @default(now()) @map("fecha_solicitud")
  aprobadoPor           String?                @map("aprobado_por") @db.VarChar(100)
  fechaAprobacion       DateTime?              @map("fecha_aprobacion")
  observaciones         String?
  activa                Boolean                @default(true)
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  persona               Persona                @relation(fields: [personaId], references: [id], onDelete: Cascade)
  historial             HistorialAjusteCuota[]

  @@index([personaId])
  @@index([estado])
  @@index([activa])
  @@index([fechaInicio, fechaFin])
  @@index([motivoExencion])
  @@index([personaId, estado, activa])
  @@map("exenciones_cuota")
}
